<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/guard/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/guard/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li:not(:nth-child(4)) > a, .site-nav > ul.nav-list:first-child > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(4) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(4) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list { display: block; } </style> <script src="/guard/assets/js/vendor/lunr.min.js"></script> <script src="/guard/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Effects | Agent Policy</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="Effects" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A declarative policy language for controlling AI agent autonomy." /> <meta property="og:description" content="A declarative policy language for controlling AI agent autonomy." /> <link rel="canonical" href="http://localhost:4000/guard/effects/" /> <meta property="og:url" content="http://localhost:4000/guard/effects/" /> <meta property="og:site_name" content="Agent Policy" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Effects" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A declarative policy language for controlling AI agent autonomy.","headline":"Effects","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/guard/assets/img/logo.svg"}},"url":"http://localhost:4000/guard/effects/"}</script> <!-- End Jekyll SEO tag --> <link rel="stylesheet" href="/guard/assets/css/custom.css"> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <header class="side-bar"> <div class="site-header"> <a href="/guard/" class="site-title lh-tight"> <div class="site-logo" role="img" aria-label="Agent Policy"></div> </a> <button id="menu-button" class="site-button btn-reset" aria-label="Menu" aria-expanded="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/guard/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/guard/getting-started/" class="nav-list-link">Getting Started</a></li><li class="nav-list-item"><a href="/guard/policy-language/" class="nav-list-link">Policy Language</a></li><li class="nav-list-item"><a href="/guard/effects/" class="nav-list-link">Effects</a></li><li class="nav-list-item"><a href="/guard/context-fallbacks/" class="nav-list-link">Context Fallbacks</a></li><li class="nav-list-item"><a href="/guard/examples/" class="nav-list-link">Examples</a></li><li class="nav-list-item"><a href="/guard/sdk-reference/" class="nav-list-link">SDK Reference</a></li></ul> </nav> <div class="d-md-block d-none site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </div> </header> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Agent Policy" autocomplete="off"> <label for="search-input" class="search-label"> <span class="sr-only">Search Agent Policy</span> <svg viewBox="0 0 24 24" class="search-icon" aria-hidden="true"><use xlink:href="#svg-search"></use></svg> </label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/agent-policy/guard" class="site-button" > GitHub </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="effects"> <a href="#effects" class="anchor-heading" aria-labelledby="effects"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Effects </h1> <p>Effects define what happens when a policy matches. Agent Policy treats effects as <strong>extensible strings</strong> – you can use any value your runtime knows how to dispatch.</p> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 120" fill="none" style="width:100%;max-width:680px;margin:1.5em auto;display:block"> <defs> <marker id="ef-arr" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"> <polygon points="0 0, 8 3, 0 6" fill="#484F58" /> </marker> </defs> <!-- allow --> <rect x="0" y="10" width="80" height="64" rx="8" fill="rgba(63,185,80,0.10)" stroke="#3FB950" stroke-width="1.5" /> <circle cx="40" cy="34" r="12" fill="none" stroke="#3FB950" stroke-width="1.5" /> <polyline points="32,34 38,40 48,28" stroke="#3FB950" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" /> <text x="40" y="66" text-anchor="middle" fill="#3FB950" font-family="system-ui,sans-serif" font-size="11" font-weight="600">allow</text> <!-- deny --> <rect x="100" y="10" width="80" height="64" rx="8" fill="rgba(248,81,73,0.10)" stroke="#F85149" stroke-width="1.5" /> <circle cx="140" cy="34" r="12" fill="none" stroke="#F85149" stroke-width="1.5" /> <line x1="132" y1="26" x2="148" y2="42" stroke="#F85149" stroke-width="2" stroke-linecap="round" /> <line x1="148" y1="26" x2="132" y2="42" stroke="#F85149" stroke-width="2" stroke-linecap="round" /> <text x="140" y="66" text-anchor="middle" fill="#F85149" font-family="system-ui,sans-serif" font-size="11" font-weight="600">deny</text> <!-- hitl --> <rect x="200" y="10" width="80" height="64" rx="8" fill="rgba(210,153,34,0.12)" stroke="#D29922" stroke-width="1.5" /> <!-- person icon --> <circle cx="240" cy="28" r="6" fill="none" stroke="#D29922" stroke-width="1.5" /> <path d="M228,46 a12,8 0 0,1 24,0" stroke="#D29922" stroke-width="1.5" fill="none" /> <text x="240" y="66" text-anchor="middle" fill="#D29922" font-family="system-ui,sans-serif" font-size="11" font-weight="600">hitl</text> <!-- aitl --> <rect x="300" y="10" width="80" height="64" rx="8" fill="rgba(88,166,255,0.10)" stroke="#58A6FF" stroke-width="1.5" /> <!-- brain/AI icon --> <circle cx="340" cy="32" r="10" fill="none" stroke="#58A6FF" stroke-width="1.5" /> <circle cx="336" cy="30" r="2" fill="#58A6FF" /> <circle cx="344" cy="30" r="2" fill="#58A6FF" /> <path d="M334,36 q6,4 12,0" stroke="#58A6FF" stroke-width="1.2" fill="none" stroke-linecap="round" /> <text x="340" y="66" text-anchor="middle" fill="#58A6FF" font-family="system-ui,sans-serif" font-size="11" font-weight="600">aitl</text> <!-- pitl --> <rect x="400" y="10" width="80" height="64" rx="8" fill="rgba(210,153,34,0.12)" stroke="#E8C244" stroke-width="1.5" /> <!-- phone icon --> <path d="M424,24 c2,-2 6,-2 8,0 l2,4 c0,2 -1,3 -3,3 l-1,0 c-1,0 -2,1 -2,2 l0,4 c0,1 1,2 2,2 l1,0 c2,0 3,1 3,3 l-2,4 c-2,2 -6,2 -8,0 c-8,-6 -8,-16 0,-22z" fill="none" stroke="#E8C244" stroke-width="1.5" /> <text x="440" y="66" text-anchor="middle" fill="#E8C244" font-family="system-ui,sans-serif" font-size="11" font-weight="600">pitl</text> <!-- filter --> <rect x="500" y="10" width="80" height="64" rx="8" fill="rgba(210,153,34,0.06)" stroke="#B8860B" stroke-width="1.5" /> <!-- filter/funnel icon --> <polygon points="522,24 558,24 546,38 546,46 534,46 534,38" fill="none" stroke="#B8860B" stroke-width="1.5" stroke-linejoin="round" /> <text x="540" y="66" text-anchor="middle" fill="#B8860B" font-family="system-ui,sans-serif" font-size="11" font-weight="600">filter</text> <!-- custom --> <rect x="600" y="10" width="80" height="64" rx="8" fill="#131920" stroke="#484F58" stroke-width="1.5" stroke-dasharray="4 3" /> <!-- gear/custom icon --> <circle cx="640" cy="32" r="8" fill="none" stroke="#484F58" stroke-width="1.5" /> <circle cx="640" cy="32" r="3" fill="#484F58" /> <text x="640" y="66" text-anchor="middle" fill="#484F58" font-family="system-ui,sans-serif" font-size="11" font-weight="600">custom</text> <!-- Label --> <text x="340" y="106" text-anchor="middle" fill="#484F58" font-family="system-ui,sans-serif" font-size="10">Well-known effects are provided as SDK constants. Custom effects are any string your runtime understands.</text> </svg> <h2 id="well-known-effects"> <a href="#well-known-effects" class="anchor-heading" aria-labelledby="well-known-effects"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Well-known effects </h2> <p>These effects are provided as constants in every SDK and cover the most common agent governance patterns:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Effect</th> <th>Constant (Python / TS / Go)</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">allow</code></td> <td><code class="language-plaintext highlighter-rouge">Effect.allow</code> / <code class="language-plaintext highlighter-rouge">ALLOW</code> / <code class="language-plaintext highlighter-rouge">EffectAllow</code></td> <td>Auto-approve. The tool runs without any intervention.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">deny</code></td> <td><code class="language-plaintext highlighter-rouge">Effect.deny</code> / <code class="language-plaintext highlighter-rouge">DENY</code> / <code class="language-plaintext highlighter-rouge">EffectDeny</code></td> <td>Block. The tool invocation is rejected.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">hitl</code></td> <td><code class="language-plaintext highlighter-rouge">Effect.hitl</code> / <code class="language-plaintext highlighter-rouge">HITL</code> / <code class="language-plaintext highlighter-rouge">EffectHITL</code></td> <td>Human-in-the-loop. A human must approve before execution.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">aitl</code></td> <td><code class="language-plaintext highlighter-rouge">Effect.aitl</code> / <code class="language-plaintext highlighter-rouge">AITL</code> / <code class="language-plaintext highlighter-rouge">EffectAITL</code></td> <td>AI-in-the-loop. An AI reviewer evaluates the invocation.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">pitl</code></td> <td><code class="language-plaintext highlighter-rouge">Effect.pitl</code> / <code class="language-plaintext highlighter-rouge">PITL</code> / <code class="language-plaintext highlighter-rouge">EffectPITL</code></td> <td>Phone-in-the-loop. Verification via outbound phone call.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">filter</code></td> <td><code class="language-plaintext highlighter-rouge">Effect.filter</code> / <code class="language-plaintext highlighter-rouge">FILTER</code> / <code class="language-plaintext highlighter-rouge">EffectFilter</code></td> <td>Content safety filter. Run a safety check (e.g., Prompt Shield) before execution.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">ask</code></td> <td><code class="language-plaintext highlighter-rouge">Effect.ask</code> / <code class="language-plaintext highlighter-rouge">ASK</code> / <code class="language-plaintext highlighter-rouge">EffectAsk</code></td> <td>Alias for <code class="language-plaintext highlighter-rouge">hitl</code>. Provided for backward compatibility.</td> </tr> </tbody> </table></div> <h2 id="custom-effects"> <a href="#custom-effects" class="anchor-heading" aria-labelledby="custom-effects"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Custom effects </h2> <p>Effects are not limited to the values above. If your system has a verification strategy the well-known effects do not cover, use it directly in YAML:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">policies</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">require-manager-approval</span>
    <span class="na">priority</span><span class="pi">:</span> <span class="m">30</span>
    <span class="na">condition</span><span class="pi">:</span>
      <span class="na">risk</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">critical</span><span class="pi">]</span>
    <span class="na">effect</span><span class="pi">:</span> <span class="s">manager-approval</span>

  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">require-mfa</span>
    <span class="na">priority</span><span class="pi">:</span> <span class="m">25</span>
    <span class="na">condition</span><span class="pi">:</span>
      <span class="na">tools</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">deploy-production</span><span class="pi">]</span>
    <span class="na">effect</span><span class="pi">:</span> <span class="s">mfa-verification</span>

  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">audit-only</span>
    <span class="na">priority</span><span class="pi">:</span> <span class="m">10</span>
    <span class="na">condition</span><span class="pi">:</span>
      <span class="na">modes</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">background</span><span class="pi">]</span>
      <span class="na">risk</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">low</span><span class="pi">]</span>
    <span class="na">effect</span><span class="pi">:</span> <span class="s">audit-log</span>
</code></pre></div></div> <p>The engine returns the effect string as-is. Your runtime dispatches on it:</p> <h3 id="python"> <a href="#python" class="anchor-heading" aria-labelledby="python"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Python </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">agent_policy_guard</span> <span class="kn">import</span> <span class="n">PolicyEngine</span><span class="p">,</span> <span class="n">EvalContext</span><span class="p">,</span> <span class="n">Effect</span>

<span class="c1"># Custom effects work through the Effect enum's extensibility
</span><span class="n">verdict</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="nf">evaluate</span><span class="p">(</span><span class="nc">EvalContext</span><span class="p">(</span><span class="n">tool</span><span class="o">=</span><span class="sh">"</span><span class="s">deploy-production</span><span class="sh">"</span><span class="p">))</span>

<span class="k">match</span> <span class="n">verdict</span><span class="p">.</span><span class="n">effect</span><span class="p">.</span><span class="n">value</span><span class="p">:</span>
    <span class="k">case</span> <span class="sh">"</span><span class="s">allow</span><span class="sh">"</span><span class="p">:</span>
        <span class="nf">execute_tool</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="k">case</span> <span class="sh">"</span><span class="s">deny</span><span class="sh">"</span><span class="p">:</span>
        <span class="nf">reject</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="k">case</span> <span class="sh">"</span><span class="s">hitl</span><span class="sh">"</span><span class="p">:</span>
        <span class="nf">request_human_approval</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="k">case</span> <span class="sh">"</span><span class="s">manager-approval</span><span class="sh">"</span><span class="p">:</span>
        <span class="nf">request_manager_sign_off</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="k">case</span> <span class="sh">"</span><span class="s">mfa-verification</span><span class="sh">"</span><span class="p">:</span>
        <span class="nf">trigger_mfa_flow</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Unknown effect: </span><span class="si">{</span><span class="n">verdict</span><span class="p">.</span><span class="n">effect</span><span class="p">.</span><span class="n">value</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Or use resolve() for cleaner dispatch
</span><span class="n">action</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="nc">EvalContext</span><span class="p">(</span><span class="n">tool</span><span class="o">=</span><span class="sh">"</span><span class="s">deploy-production</span><span class="sh">"</span><span class="p">))</span>
<span class="n">dispatch_table</span><span class="p">[</span><span class="n">action</span><span class="p">](</span><span class="n">ctx</span><span class="p">)</span>
</code></pre></div></div> <h3 id="typescript"> <a href="#typescript" class="anchor-heading" aria-labelledby="typescript"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> TypeScript </h3> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">PolicyEngine</span><span class="p">,</span> <span class="nx">ALLOW</span><span class="p">,</span> <span class="nx">DENY</span><span class="p">,</span> <span class="nx">HITL</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@agent-policy/guard</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">engine</span><span class="p">.</span><span class="nf">resolve</span><span class="p">({</span> <span class="na">tool</span><span class="p">:</span> <span class="dl">"</span><span class="s2">deploy-production</span><span class="dl">"</span> <span class="p">});</span>

<span class="kd">const</span> <span class="nx">handlers</span><span class="p">:</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">:</span> <span class="nx">Context</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="nx">ALLOW</span><span class="p">]:</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nf">executeTool</span><span class="p">(</span><span class="nx">ctx</span><span class="p">),</span>
  <span class="p">[</span><span class="nx">DENY</span><span class="p">]:</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nf">reject</span><span class="p">(</span><span class="nx">ctx</span><span class="p">),</span>
  <span class="p">[</span><span class="nx">HITL</span><span class="p">]:</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nf">requestApproval</span><span class="p">(</span><span class="nx">ctx</span><span class="p">),</span>
  <span class="dl">"</span><span class="s2">manager-approval</span><span class="dl">"</span><span class="p">:</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nf">requestManagerSignOff</span><span class="p">(</span><span class="nx">ctx</span><span class="p">),</span>
  <span class="dl">"</span><span class="s2">mfa-verification</span><span class="dl">"</span><span class="p">:</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nf">triggerMfaFlow</span><span class="p">(</span><span class="nx">ctx</span><span class="p">),</span>
<span class="p">};</span>

<span class="nx">handlers</span><span class="p">[</span><span class="nx">action</span><span class="p">]?.(</span><span class="nx">ctx</span><span class="p">)</span> <span class="o">??</span> <span class="nf">throwUnknownEffect</span><span class="p">(</span><span class="nx">action</span><span class="p">);</span>
</code></pre></div></div> <h3 id="go"> <a href="#go" class="anchor-heading" aria-labelledby="go"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Go </h3> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">action</span> <span class="o">:=</span> <span class="n">engine</span><span class="o">.</span><span class="n">Resolve</span><span class="p">(</span><span class="n">guard</span><span class="o">.</span><span class="n">EvalContext</span><span class="p">{</span><span class="n">Tool</span><span class="o">:</span> <span class="s">"deploy-production"</span><span class="p">})</span>

<span class="k">switch</span> <span class="n">action</span> <span class="p">{</span>
<span class="k">case</span> <span class="kt">string</span><span class="p">(</span><span class="n">guard</span><span class="o">.</span><span class="n">EffectAllow</span><span class="p">)</span><span class="o">:</span>
    <span class="n">executeTool</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
<span class="k">case</span> <span class="kt">string</span><span class="p">(</span><span class="n">guard</span><span class="o">.</span><span class="n">EffectDeny</span><span class="p">)</span><span class="o">:</span>
    <span class="n">reject</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
<span class="k">case</span> <span class="kt">string</span><span class="p">(</span><span class="n">guard</span><span class="o">.</span><span class="n">EffectHITL</span><span class="p">)</span><span class="o">:</span>
    <span class="n">requestApproval</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
<span class="k">case</span> <span class="s">"manager-approval"</span><span class="o">:</span>
    <span class="n">requestManagerSignOff</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
<span class="k">default</span><span class="o">:</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"unknown effect: %s"</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="the-resolve-method"> <a href="#the-resolve-method" class="anchor-heading" aria-labelledby="the-resolve-method"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The <code class="language-plaintext highlighter-rouge">resolve()</code> method </h2> <p>Every SDK provides a <code class="language-plaintext highlighter-rouge">resolve()</code> method that returns just the effect as a plain string. This is the recommended way to integrate with systems that dispatch on strings:</p> <div class="table-wrapper"><table> <thead> <tr> <th>SDK</th> <th>Method</th> <th>Returns</th> </tr> </thead> <tbody> <tr> <td>Python</td> <td><code class="language-plaintext highlighter-rouge">engine.resolve(ctx)</code></td> <td><code class="language-plaintext highlighter-rouge">str</code> (e.g., <code class="language-plaintext highlighter-rouge">"hitl"</code>)</td> </tr> <tr> <td>TypeScript</td> <td><code class="language-plaintext highlighter-rouge">engine.resolve(ctx)</code></td> <td><code class="language-plaintext highlighter-rouge">string</code></td> </tr> <tr> <td>Go</td> <td><code class="language-plaintext highlighter-rouge">engine.Resolve(ctx)</code></td> <td><code class="language-plaintext highlighter-rouge">string</code></td> </tr> </tbody> </table></div> <p>Use <code class="language-plaintext highlighter-rouge">resolve()</code> when you only need the effect. Use <code class="language-plaintext highlighter-rouge">evaluate()</code> when you also need the channel, matched policy ID, or want to inspect the full verdict.</p> <h2 id="design-rationale"> <a href="#design-rationale" class="anchor-heading" aria-labelledby="design-rationale"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Design rationale </h2> <p>Effects are strings rather than a fixed enum so that the policy language can evolve alongside your system. If you add a new approval strategy to your runtime next month, you can use it in policy YAML immediately – no library upgrade required.</p> <p>The well-known constants exist for ergonomics and IDE autocompletion, but they are not enforced during evaluation. The engine is intentionally permissive: it evaluates conditions and returns whatever effect string the matched policy declares.</p> </main> <hr> <footer> <p class="text-small mb-0">Agent Policy is open source under the MIT License.</p> <div class="d-md-none mt-4 fs-2"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
